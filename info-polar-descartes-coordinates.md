# Аналіз використання координат в алгоритмі

На основі статті Васіна та наданого коду можу пояснити, що обидві системи координат використовуються протягом різних етапів алгоритму:

## Полярні координати використовуються для:

1. **Генерації початкового розподілу маркерів**
   ```python
   signals_radii = self.search_radius * np.sqrt(np.random.uniform(0, 1, self.N0))
   signals_angles = np.random.uniform(0, 2 * np.pi, self.N0)
   ```

2. **Представлення даних у вигляді сітки для обчислення ваг**
   - У статті Васіна (стор. 3) чітко показано, що дані представляються на полярній сітці (Рис. 1 і 2)
   - В коді ми бачимо:
   ```python
   r_edges = np.linspace(0, self.search_radius, num_r + 1)
   theta_edges = np.linspace(0, 2 * np.pi, num_theta + 1)
   ```

3. **Обчислення відстаней для функції правдоподібності**
   - У функції `compute_weights` використовується формула для відстані в полярних координатах:
   ```python
   d = np.sqrt(r_c ** 2 + r_signals ** 2 - 2 * r_c * r_signals * np.cos(theta_c - theta_signals))
   ```
   - Ця формула походить з формули для z-grid (8) у статті Васіна

4. **Візуалізації результатів**
   - У методі `visualize` є окремий полярний графік:
   ```python
   ax2 = plt.subplot(122, projection='polar')
   ```

## Декартові координати використовуються для:

1. **Зберігання позицій маркерів та операцій з ними**
   ```python
   markers = np.column_stack((
       radii * np.cos(angles),
       radii * np.sin(angles),
       amplitudes
   ))
   ```

2. **Обчислення зваженого центру мас та руху маркерів**
   ```python
   x_k = np.sum(weights[:, np.newaxis] * positions, axis=0)
   ```

3. **Додавання шуму та руху до маркерів**
   ```python
   markers[state2_mask, :2] += noise * dt
   ```

## Висновок:

Алгоритм **постійно перемикається** між полярними та декартовими координатами:
- Маркери зберігаються в декартових координатах
- Сітка для обчислень z-grid та ваг створюється в полярних координатах
- Функція правдоподібності використовує відстані, обчислені в полярних координатах
- Центр мас та рух обчислюються в декартових координатах

Це відповідає природі задачі - пошук об'єктів у круговій області (як у сонарі), де деякі операції природніше виконувати в полярних координатах, а інші - в декартових.